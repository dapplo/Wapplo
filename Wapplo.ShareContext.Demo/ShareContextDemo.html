<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8"/>
	<title>Share context demo</title>
</head>
<body>
	<div id="status"></div>
	<input type="text" id="origin" value="Identifier" />
	<input type="text" id="test" value="Another value" />
	<input type="button" id="share" value="share"/>
	<div id="output"></div>
<script src="Scripts/jquery-2.2.4.min.js"></script>
<script src="Scripts/jquery.signalR-2.2.1.min.js"></script>
<!-- Reference the autogenerated SignalR hub script. -->
<script src="http://localhost:9277/signalr/hubs"></script>
<script>
	$(document).ready(function() {
		$.connection.hub.url = "http://localhost:9277/signalr";
		// Enable logging
		$.connection.hub.logging = true;
		var shareContextHub = $.connection.shareContextHub;
		var statusDiv = $("#status");

		shareContextHub.client.contextShared = function (sharedContext) {
			$("#output").append(sharedContext.values.time + "<strong>" + sharedContext.origin + "</strong></br>");
		};
		$("#share").click(function () {
			var now = new Date();
			var options = { weekday: "short", year: "numeric", month: "short", day: "numeric" };
			var nowText = now.toLocaleTimeString(this.locale) + " " + now.toLocaleDateString(this.locale, options);
			shareContextHub.server.shareContext(
				{
					origin: $("#origin").val(),
					Values: {
						test: $("#test").val(),
						time: nowText
					}
				}
			);
		});

		$.connection.hub.start()
			.done(function () {
				statusDiv.text("connected.");
				$.connection.hub.connectionSlow(function() {
					statusDiv.text("Slow connection....");
					setTimeout(function() {
							statusDiv.text("Connected.");
						},
						2000); // Clear yellow in 2 seconds
				});
				$.connection.hub.reconnecting(function() {
					statusDiv.text("Retrying to connect...");
				});
				$.connection.hub.reconnected(function() {
					statusDiv.text("Reconnected.");
				});
				$.connection.hub.disconnected(function() {
					if ($.connection.hub.lastError) {
						statusDiv.text("Connection lost. Reason: " + $.connection.hub.lastError.message);
					} else {
						statusDiv.text("Connection lost.");
					}
					setTimeout(function() {
							statusDiv.text("Connecting...");
							$.connection.hub.start()
								.done(function() {
									statusDiv.text("Connected.");
								});
						},
						3000); // Restart connection after 3 seconds.
				});
			})
			.fail(function() {
				alert("No connection to server");
			});

	});

</script>
</body>
</html>