<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8"/>
	<title>Share context demo</title>
</head>
<body>
	<div id="status"></div>
	<input type="text" id="origin" value="Identifier" />
	<input type="text" id="test" value="Another value" />
	<input type="button" id="share" value="share"/>
	<div id="output"></div>
<script src="Scripts/jquery-2.2.4.min.js"></script>
<script src="Scripts/jquery.signalR-2.2.3.min.js"></script>
<!-- Reference the autogenerated SignalR hub script. -->
<script src="http://localhost:9277/signalr/hubs"></script>
<script>
	$(document).ready(function() {
		$.connection.hub.url = "http://localhost:9277/signalr";
		// Enable logging
		$.connection.hub.logging = true;

		var statusDiv = $("#status");

		var shareContextHub = $.connection.shareContextHub;

		var demoCard = {
			"$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
			"type": "AdaptiveCard",
			"version": "1.0",
			"body": [
				{
					"type": "Container",
					"items": [
						{
							"type": "TextBlock",
							"text": "Publish Adaptive Card schema",
							"weight": "bolder",
							"size": "medium"
						},
						{
							"type": "ColumnSet",
							"columns": [
								{
									"type": "Column",
									"width": "auto",
									"items": [
										{
											"type": "Image",
											"url": "https://pbs.twimg.com/profile_images/3647943215/d7f12830b3c17a5a9e4afcc370e3a37e_400x400.jpeg",
											"size": "small",
											"style": "person"
										}
									]
								},
								{
									"type": "Column",
									"width": "stretch",
									"items": [
										{
											"type": "TextBlock",
											"text": "Matt Hidinger",
											"weight": "bolder",
											"wrap": true
										},
										{
											"type": "TextBlock",
											"spacing": "none",
											"text": "Created {{DATE(2017-02-14T06:08:39Z, SHORT)}}",
											"isSubtle": true,
											"wrap": true
										}
									]
								}
							]
						}
					]
				},
				{
					"type": "Container",
					"items": [
						{
							"type": "TextBlock",
							"text": "Now that we have defined the main rules and features of the format, we need to produce a schema and publish it to GitHub. The schema will be the starting point of our reference documentation.",
							"wrap": true
						},
						{
							"type": "FactSet",
							"facts": [
								{
									"title": "Board:",
									"value": "Adaptive Card"
								},
								{
									"title": "List:",
									"value": "Backlog"
								},
								{
									"title": "Assigned to:",
									"value": "Matt Hidinger"
								},
								{
									"title": "Due date:",
									"value": "Not set"
								}
							]
						}
					]
				}
			],
			"actions": [
				{
					"type": "Action.ShowCard",
					"title": "Set due date",
					"card": {
						"type": "AdaptiveCard",
						"body": [
							{
								"type": "Input.Date",
								"id": "dueDate"
							}
						],
						"actions": [
							{
								"type": "Action.Submit",
								"title": "OK"
							}
						]
					}
				},
				{
					"type": "Action.ShowCard",
					"title": "Comment",
					"card": {
						"type": "AdaptiveCard",
						"body": [
							{
								"type": "Input.Text",
								"id": "comment",
								"isMultiline": true,
								"placeholder": "Enter your comment"
							}
						],
						"actions": [
							{
								"type": "Action.Submit",
								"title": "OK"
							}
						]
					}
				}
			]
		};
			
		/**
		* Example for the windows services
		**/
		var windowsServicesHub = $.connection.windowsServicesHub;
		windowsServicesHub.client.clipboardChanged = function (clipboardContents) {
			$("#output").append("Clipboard: <strong>ID=" + clipboardContents.id + ",hWnd:" + clipboardContents.ownerHandle.value + ", formats=" + clipboardContents.formats + "</strong></br>");
		};
		/**
		* Example for the share context
		**/
		shareContextHub.client.contextShared = function (sharedContext) {
			$("#output").append(" " + sharedContext.values.time + "<strong>" + sharedContext.origin + "</strong>:");
			for(var index in sharedContext.values) {
				if (!sharedContext.values.hasOwnProperty(index)) {
					continue;
				}
				if (index === "time") {
					continue;
				}
				$("#output").append(index + "=" + sharedContext.values[index]);
			}
			$("#output").append("</br>");
		};
		$("#share").click(function () {
			var now = new Date();
			var options = { weekday: "short", year: "numeric", month: "short", day: "numeric" };
			var nowText = now.toLocaleTimeString(this.locale) + " " + now.toLocaleDateString(this.locale, options);
			shareContextHub.server.shareContext(
				{
					origin: $("#origin").val(),
					Values: {
						test: $("#test").val(),
						time: nowText
					}
				}
			);

		});

		$.connection.hub.start()
			.done(function () {
				windowsServicesHub.server.monitorClipboard(true);
				windowsServicesHub.server.showAdaptiveCard(demoCard);

				statusDiv.text("connected.");
				$.connection.hub.connectionSlow(function() {
					statusDiv.text("Slow connection....");
					setTimeout(function() {
							statusDiv.text("Connected.");
						},
						2000); // Clear yellow in 2 seconds
				});
				$.connection.hub.reconnecting(function() {
					statusDiv.text("Retrying to connect...");
				});
				$.connection.hub.reconnected(function() {
					statusDiv.text("Reconnected.");
				});
				$.connection.hub.disconnected(function() {
					if ($.connection.hub.lastError) {
						statusDiv.text("Connection lost. Reason: " + $.connection.hub.lastError.message);
					} else {
						statusDiv.text("Connection lost.");
					}
					setTimeout(function() {
							statusDiv.text("Connecting...");
							$.connection.hub.start()
								.done(function() {
									statusDiv.text("Connected.");
								});
						},
						3000); // Restart connection after 3 seconds.
				});
			})
			.fail(function() {
				alert("No connection to server");
			});

	});

</script>
</body>
</html>